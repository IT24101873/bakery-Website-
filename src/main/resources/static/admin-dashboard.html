<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Bakery Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-image: url('https://images.unsplash.com/photo-1600585154347-be6161a56a0c');
      background-size: cover;
      background-attachment: fixed;
    }
  </style>
</head>
<body class="min-h-screen p-6">
<div class="bg-white bg-opacity-90 p-8 rounded-lg shadow-lg max-w-5xl mx-auto">
  <h1 class="text-3xl font-bold text-center text-blue-600 mb-6"> Admin Dashboard - Manage Orders </h1>
  <table class="w-full text-left border-collapse">
    <thead>
    <tr class="bg-blue-100">
      <th class="p-3">Order ID</th>
      <th class="p-3">Customer</th>
      <th class="p-3">Item</th>
      <th class="p-3">Pickup Time</th>
      <th class="p-3">Status</th>
      <th class="p-3">Details</th>
      <th class="p-3">Actions</th>
    </tr>
    </thead>
    <tbody id="adminOrderTableBody">
    <!-- Orders will be populated dynamically -->
    </tbody>
  </table>
  <div class="flex justify-between mt-6">
    <a href="/order-form.html" class="text-blue-600 hover:underline">Place a New Order</a>
    <a href="/order-list.html" class="text-blue-600 hover:underline">View Public Orders</a>
  </div>
</div>
<script>
  async function loadAdminOrders() {
    const response = await fetch('/api/admin/orders');
    const orders = await response.json();
    const tbody = document.getElementById('adminOrderTableBody');
    tbody.innerHTML = ''; // Clear any existing rows
    if (orders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="p-3 text-center text-gray-600">No orders yet. Place an order to get started!</td></tr>';
      return;
    }
    orders.forEach(order => {
      const row = document.createElement('tr');
      row.className = 'border-b hover:bg-blue-50';
      row.innerHTML = `
                    <td class="p-3">${order.orderId}</td>
                    <td class="p-3">${order.customerName}</td>
                    <td class="p-3">${order.item}</td>
                    <td class="p-3">${order.pickupTime}</td>
                    <td class="p-3">
                        <select onchange="updateStatus('${order.orderId}', this.value)" class="border rounded p-1">
                            <option value="PENDING" ${order.status === 'PENDING' ? 'selected' : ''}>Pending</option>
                            <option value="READY" ${order.status === 'READY' ? 'selected' : ''}>Ready</option>
                            <option value="CANCELED" ${order.status === 'CANCELED' ? 'selected' : ''}>Canceled</option>
                        </select>
                    </td>
                    <td class="p-3">${order.orderDetails}</td>
                    <td class="p-3">
                        <button onclick="deleteOrder('${order.orderId}')"
                                class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg transition duration-300">
                            Delete
                        </button>
                    </td>
                `;
      tbody.appendChild(row);
    });
  }

  async function updateStatus(orderId, status) {
    const response = await fetch('/api/admin/update-status', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `orderId=${orderId}&status=${status}`
    });
    if (response.ok) {
      loadAdminOrders(); // Refresh the table
    } else {
      alert('Failed to update status. Please try again.');
    }
  }

  async function deleteOrder(orderId) {
    if (confirm('Are you sure you want to delete this order?')) {
      const response = await fetch(`/api/admin/delete?orderId=${orderId}`, {
        method: 'DELETE'
      });
      if (response.ok) {
        loadAdminOrders(); // Refresh the table
      } else {
        alert('Failed to delete order. Please try again.');
      }
    }
  }

  // Load orders when the page loads
  window.onload = loadAdminOrders;
</script>
</body>
</html>