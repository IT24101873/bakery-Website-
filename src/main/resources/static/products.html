<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bakery Product Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background-color: #fff9f0;
        }
        h1 {
            color: #d2691e;
        }
        form, table {
            margin-top: 20px;
            width: 100%;
            max-width: 800px;
        }
        input, button, select {
            padding: 8px;
            margin: 6px 0;
            width: 100%;
            font-size: 14px;
        }
        table {
            border-collapse: collapse;
            margin-top: 30px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            font-size: 14px;
        }
        th {
            background-color: #f4a460;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #fef1e8;
        }
        .btn-group button {
            margin-right: 5px;
            width: auto;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>Bakery Product Management</h1>

<form id="productForm">
    <input type="hidden" id="productId">
    <label for="productName">Product Name</label>
    <input type="text" id="productName" required>

    <label for="productPrice">Price</label>
    <input type="number" id="productPrice" required>

    <label for="customMessage">Custom Message (Optional)</label>
    <input type="text" id="customMessage">

    <label for="productType">Product Type:</label>
    <select id="productType">
        <option value="product">Regular Product</option>
        <option value="customCake" selected>Custom Cake</option>
    </select>

    <button type="submit">Save Product</button>
</form>

<table id="productsTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Product Type</th>
        <th>Custom Message</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    // Mock database
    let mockProducts = [
        { id: 1, name: "Chocolate Cake", price: 24.99, type: "customCake", customMessage: "Happy Birthday!" },
        { id: 2, name: "Baguette", price: 3.50, type: "product" },
        {id: 3, name: "Banana Bread", price: 2.45,type: "product"},
        {id: 4, name: "Ribbon Cake", price: 25.99, type: "customCake", customMessage:"Congratulations!"},
        {id: 5, name: "Muffin", price: 2.32,type:"product"}
    ];

    // Mock API implementation
    window.fetch = (function(originalFetch) {
        return function(url, options) {
            // Products API
            if (url === '/api/products') {
                if (options && options.method === 'POST') {
                    // Add new product
                    return new Promise(resolve => {
                        const newProduct = JSON.parse(options.body);
                        newProduct.id = mockProducts.length + 1;
                        mockProducts.push(newProduct);
                        resolve(new Response(JSON.stringify(newProduct)));
                    });
                }
                else if (options && options.method === 'PUT') {
                    // Update product
                    return new Promise(resolve => {
                        const id = parseInt(url.split('/').pop());
                        const updatedProduct = JSON.parse(options.body);
                        mockProducts = mockProducts.map(p => p.id === id ? {...p, ...updatedProduct} : p);
                        resolve(new Response(JSON.stringify(updatedProduct)));
                    });
                }
                else if (options && options.method === 'DELETE') {
                    // Delete product
                    return new Promise(resolve => {
                        const id = parseInt(url.split('/').pop());
                        mockProducts = mockProducts.filter(p => p.id !== id);
                        resolve(new Response(JSON.stringify({ success: true })));
                    });
                }
                else {
                    // Get all products
                    return new Promise(resolve => {
                        resolve(new Response(JSON.stringify(mockProducts)));
                    });
                }
            }

            // Specific product API
            if (url.startsWith('/api/products/')) {
                const id = parseInt(url.split('/').pop());
                const product = mockProducts.find(p => p.id === id);
                return new Promise(resolve => {
                    resolve(new Response(JSON.stringify(product)));
                });
            }

            // Fallback to original fetch
            return originalFetch.apply(this, arguments);
        };
    })(window.fetch);

    const API_URL = '/api/products';

    document.addEventListener('DOMContentLoaded', fetchProducts);
    document.getElementById('productForm').addEventListener('submit', handleFormSubmit);

    function fetchProducts() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector('#productsTable tbody');
                tbody.innerHTML = '';
                data.forEach(product => {
                    const row = `
                            <tr>
                                <td>${product.id}</td>
                                <td>${product.name}</td>
                                <td>$${product.price.toFixed(2)}</td>
                                <td>${product.type === 'customCake' ? 'Custom Cake' : 'Regular Product'}</td>
                                <td>${product.customMessage || ''}</td>
                                <td class="btn-group">
                                    <button onclick="editProduct(${product.id})">Edit</button>
                                    <button onclick="deleteProduct(${product.id})">Delete</button>
                                </td>
                            </tr>
                        `;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            });
    }

    function handleFormSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('productId').value;
        const name = document.getElementById('productName').value;
        const price = parseFloat(document.getElementById('productPrice').value);
        const customMessage = document.getElementById('customMessage').value;
        const type = document.getElementById('productType').value;

        const payload = { name, price, type };
        if (customMessage && type === 'customCake') {
            payload.customMessage = customMessage;
        }

        const method = id ? 'PUT' : 'POST';
        const url = id ? `${API_URL}/${id}` : API_URL;

        fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
            .then(() => {
                resetForm();
                fetchProducts();
            });
    }

    function editProduct(id) {
        fetch(`${API_URL}/${id}`)
            .then(res => res.json())
            .then(product => {
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('customMessage').value = product.customMessage || '';
                document.getElementById('productType').value = product.type;
            });
    }

    function deleteProduct(id) {
        if (confirm('Are you sure you want to delete this product?')) {
            fetch(`${API_URL}/${id}`, { method: 'DELETE' })
                .then(() => fetchProducts());
        }
    }

    function resetForm() {
        document.getElementById('productForm').reset();
        document.getElementById('productId').value = '';
        document.getElementById('productType').value = 'customCake';
    }
</script>
</body>
</html>